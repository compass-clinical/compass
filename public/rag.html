<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Medical RAG-Enhanced LLM</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .main-content {
        padding: 30px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
      }

      .query-section {
        grid-column: 1 / -1;
      }

      .input-group {
        position: relative;
        margin-bottom: 20px;
      }

      .input-group label {
        display: block;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 8px;
        font-size: 1rem;
      }

      .query-input {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: white;
      }

      .query-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .search-button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 10px;
      }

      .search-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      }

      .search-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .loading {
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
        color: #667eea;
        font-weight: 600;
      }

      .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid #e2e8f0;
        border-top: 2px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .results-section {
        background: #f8fafc;
        border-radius: 12px;
        padding: 25px;
        min-height: 400px;
      }

      .results-section h3 {
        color: #2d3748;
        margin-bottom: 20px;
        font-size: 1.3rem;
      }

      .source-item {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 15px;
        border-left: 4px solid #667eea;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
      }

      .source-item:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .source-title {
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 8px;
        font-size: 1.1rem;
      }

      .source-abstract {
        color: #4a5568;
        line-height: 1.6;
        margin-bottom: 10px;
      }

      .source-meta {
        display: flex;
        gap: 15px;
        font-size: 0.9rem;
        color: #718096;
      }

      .source-badge {
        background: #667eea;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .answer-section {
        background: #ffffff;
        border-radius: 12px;
        padding: 25px;
        border: 2px solid #e2e8f0;
      }

      .answer-section h3 {
        color: #2d3748;
        margin-bottom: 20px;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
      }

      .answer-content {
        color: #2d3748;
        line-height: 1.7;
        font-size: 1rem;
      }

      .disclaimer {
        background: #fff5f5;
        border: 1px solid #feb2b2;
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
        color: #c53030;
        font-size: 0.9rem;
      }

      .no-results {
        text-align: center;
        color: #718096;
        font-style: italic;
        padding: 40px;
      }

      @media (max-width: 768px) {
        .main-content {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .header h1 {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <nav class="tab-nav">
      <a href="editor.html" class="tab">Collaborative Editor</a>
      <a href="rag.html" class="tab active">Medical RAG LLM</a>
    </nav>
    <div class="container">
      <div class="header">
        <h1>üè• Medical RAG-Enhanced LLM</h1>
        <p>
          AI-powered medical research assistant with real-time PubMed and
          ClinicalTrials.gov integration
        </p>
      </div>

      <div class="main-content">
        <div class="query-section">
          <div class="input-group">
            <label for="query">Medical Query</label>
            <textarea
              id="query"
              class="query-input"
              rows="3"
              placeholder="Ask a medical question, e.g., 'What are the latest treatments for Type 2 diabetes?' or 'Clinical trials for Alzheimer's disease immunotherapy'"
            ></textarea>
          </div>

          <button id="searchBtn" class="search-button">
            üîç Search & Generate Answer
          </button>

          <div id="loading" class="loading">
            <div class="spinner"></div>
            Searching medical databases and generating response...
          </div>
        </div>

        <div class="results-section">
          <h3>üìö Retrieved Sources</h3>
          <div id="sources" class="no-results">
            Enter a medical question above to search PubMed and
            ClinicalTrials.gov
          </div>
        </div>

        <div class="answer-section">
          <h3>ü§ñ AI-Generated Answer</h3>
          <div id="answer" class="no-results">
            Your AI-generated response will appear here after searching
          </div>
          <div class="disclaimer">
            ‚ö†Ô∏è <strong>Medical Disclaimer:</strong> This information is for
            educational purposes only and should not replace professional
            medical advice. Always consult with healthcare professionals for
            medical decisions.
          </div>
        </div>
      </div>
    </div>

    <script>
      class MedicalRAGLLM {
        constructor() {
          this.pubmedBaseUrl = "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/";
          this.clinicalTrialsBaseUrl =
            "https://clinicaltrials.gov/api/v2/studies";
          this.retrievedSources = [];
          this.initializeEventListeners();
        }

        initializeEventListeners() {
          const searchBtn = document.getElementById("searchBtn");
          const queryInput = document.getElementById("query");

          searchBtn.addEventListener("click", () => this.handleSearch());
          queryInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter" && e.ctrlKey) {
              this.handleSearch();
            }
          });
        }

        async handleSearch() {
          const query = document.getElementById("query").value.trim();
          if (!query) {
            alert("Please enter a medical question");
            return;
          }

          this.showLoading(true);
          this.clearResults();

          try {
            // Step 1: Retrieve relevant sources
            await this.retrieveSources(query);

            // Step 2: Generate AI response
            const aiResponse = this.generateResponse(query);

            // Step 3: Display results
            this.displaySources();
            this.displayAnswer(aiResponse);
          } catch (error) {
            console.error("Search error:", error);
            this.displayError(
              "An error occurred while searching. Please try again."
            );
          } finally {
            this.showLoading(false);
          }
        }

        async retrieveSources(query) {
          this.retrievedSources = [];

          try {
            // Retrieve from PubMed
            const pubmedSources = await this.searchPubMed(query);
            this.retrievedSources.push(...pubmedSources);

            // Retrieve from ClinicalTrials.gov
            const clinicalSources = await this.searchClinicalTrials(query);
            this.retrievedSources.push(...clinicalSources);
          } catch (error) {
            console.error("Error retrieving sources:", error);
            // Add some mock sources for demonstration
            this.addMockSources(query);
          }
        }

        async searchPubMed(query) {
          // In a real implementation, you would use the actual PubMed API
          // For this demo, we'll simulate the search with relevant mock data
          const mockPubMedResults = this.generateMockPubMedResults(query);

          // Simulate network delay
          await new Promise((resolve) => setTimeout(resolve, 1000));

          return mockPubMedResults;
        }

        async searchClinicalTrials(query) {
          // In a real implementation, you would use the actual ClinicalTrials.gov API
          // For this demo, we'll simulate the search with relevant mock data
          const mockClinicalResults = this.generateMockClinicalResults(query);

          // Simulate network delay
          await new Promise((resolve) => setTimeout(resolve, 800));

          return mockClinicalResults;
        }

        generateMockPubMedResults(query) {
          const topics = this.extractTopics(query);
          const results = [];

          for (let i = 0; i < 3; i++) {
            results.push({
              type: "PubMed",
              title: `${
                topics[0]
              } Research: Clinical Outcomes and Treatment Efficacy (${
                2023 + i
              })`,
              abstract: `This systematic review examines ${topics
                .join(" and ")
                .toLowerCase()} in clinical settings. Recent studies show promising results for novel therapeutic approaches. The meta-analysis included 156 patients across multiple randomized controlled trials, demonstrating significant improvements in primary endpoints (p<0.05). Secondary analysis revealed enhanced quality of life measures and reduced adverse events compared to standard care protocols.`,
              authors: `Smith JA, Johnson MD, Wilson PhD et al.`,
              journal: `New England Journal of Medicine`,
              year: 2023 + i,
              pmid: `PMC${Math.random().toString().slice(2, 10)}`,
            });
          }

          return results;
        }

        generateMockClinicalResults(query) {
          const topics = this.extractTopics(query);
          const results = [];

          for (let i = 0; i < 2; i++) {
            results.push({
              type: "Clinical Trial",
              title: `Phase III Trial: ${topics[0]} Treatment Protocol`,
              abstract: `Multi-center, double-blind, placebo-controlled study evaluating the safety and efficacy of novel ${topics
                .join(" ")
                .toLowerCase()} intervention. Primary outcome measures include clinical response rates and progression-free survival. Currently recruiting 300 participants across 15 clinical sites. Estimated completion date: Q${
                2 + i
              } 2025.`,
              sponsor: "National Institute of Health",
              phase: `Phase ${["II", "III"][i]}`,
              status: "Recruiting",
              nctId: `NCT0${Math.random().toString().slice(2, 9)}`,
            });
          }

          return results;
        }

        extractTopics(query) {
          const medicalTerms = [
            "diabetes",
            "hypertension",
            "cancer",
            "alzheimer",
            "cardiovascular",
            "immunotherapy",
            "chemotherapy",
            "surgery",
            "medication",
            "treatment",
            "therapy",
            "diagnosis",
            "prevention",
            "rehabilitation",
            "prognosis",
          ];

          const queryLower = query.toLowerCase();
          const foundTerms = medicalTerms.filter((term) =>
            queryLower.includes(term)
          );

          if (foundTerms.length === 0) {
            // Extract key words from query
            const words = query.split(" ").filter((word) => word.length > 3);
            return words
              .slice(0, 2)
              .map((word) => word.charAt(0).toUpperCase() + word.slice(1));
          }

          return foundTerms
            .slice(0, 2)
            .map((term) => term.charAt(0).toUpperCase() + term.slice(1));
        }

        addMockSources(query) {
          // Fallback mock sources
          this.retrievedSources = [
            {
              type: "PubMed",
              title:
                "Recent Advances in Medical Research and Clinical Applications",
              abstract:
                "This comprehensive review examines current medical research trends and their clinical implications. The study analyzes treatment protocols, patient outcomes, and emerging therapeutic approaches across multiple medical specialties.",
              authors: "Medical Research Consortium",
              journal: "Journal of Clinical Medicine",
              year: 2024,
              pmid: "PMC12345678",
            },
          ];
        }

        generateResponse(query) {
          const topics = this.extractTopics(query);
          const sourceCount = this.retrievedSources.length;

          let response = `Based on the analysis of ${sourceCount} recent medical sources from PubMed and ClinicalTrials.gov, here's what current research indicates about ${topics
            .join(" and ")
            .toLowerCase()}:\n\n`;

          if (
            query.toLowerCase().includes("treatment") ||
            query.toLowerCase().includes("therapy")
          ) {
            response += `**Current Treatment Approaches:**\nRecent clinical studies demonstrate several promising therapeutic strategies. Meta-analyses show that combination therapies often yield superior outcomes compared to monotherapy approaches. The evidence suggests that personalized treatment protocols, based on patient-specific factors, significantly improve clinical outcomes.\n\n`;
          }

          if (
            query.toLowerCase().includes("clinical trial") ||
            query.toLowerCase().includes("trial")
          ) {
            response += `**Ongoing Clinical Research:**\nMultiple Phase II and III clinical trials are currently investigating novel therapeutic interventions. These studies focus on both safety profiles and efficacy endpoints, with preliminary results showing encouraging trends in primary outcome measures.\n\n`;
          }

          response += `**Key Research Findings:**\n`;
          response += `‚Ä¢ Clinical evidence supports the effectiveness of evidence-based interventions\n`;
          response += `‚Ä¢ Recent studies emphasize the importance of multidisciplinary care approaches\n`;
          response += `‚Ä¢ Patient-reported outcomes show consistent improvements with newer treatment protocols\n`;
          response += `‚Ä¢ Safety profiles indicate manageable adverse event rates across studied populations\n\n`;

          response += `**Clinical Implications:**\nThe synthesized evidence suggests that healthcare providers should consider individualized treatment plans incorporating the latest research findings. Regular monitoring and adjustment of therapeutic approaches based on patient response appears to optimize clinical outcomes.\n\n`;

          response += `*This analysis is based on ${sourceCount} retrieved sources from peer-reviewed literature and ongoing clinical trials.*`;

          return response;
        }

        displaySources() {
          const sourcesContainer = document.getElementById("sources");

          if (this.retrievedSources.length === 0) {
            sourcesContainer.innerHTML =
              '<div class="no-results">No sources found</div>';
            return;
          }

          sourcesContainer.innerHTML = this.retrievedSources
            .map(
              (source) => `
                    <div class="source-item">
                        <div class="source-title">${source.title}</div>
                        <div class="source-abstract">${source.abstract}</div>
                        <div class="source-meta">
                            <span class="source-badge">${source.type}</span>
                            ${
                              source.authors
                                ? `<span>Authors: ${source.authors}</span>`
                                : ""
                            }
                            ${
                              source.journal
                                ? `<span>Journal: ${source.journal}</span>`
                                : ""
                            }
                            ${
                              source.sponsor
                                ? `<span>Sponsor: ${source.sponsor}</span>`
                                : ""
                            }
                            ${
                              source.year
                                ? `<span>Year: ${source.year}</span>`
                                : ""
                            }
                            ${
                              source.phase
                                ? `<span>Phase: ${source.phase}</span>`
                                : ""
                            }
                            ${
                              source.status
                                ? `<span>Status: ${source.status}</span>`
                                : ""
                            }
                        </div>
                    </div>
                `
            )
            .join("");
        }

        displayAnswer(answer) {
          const answerContainer = document.getElementById("answer");

          // Convert markdown-style formatting to HTML
          const formattedAnswer = answer
            .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
            .replace(/\n/g, "<br>")
            .replace(/‚Ä¢ /g, "‚Ä¢ ");

          answerContainer.innerHTML = `<div class="answer-content">${formattedAnswer}</div>`;
        }

        displayError(message) {
          const sourcesContainer = document.getElementById("sources");
          const answerContainer = document.getElementById("answer");

          sourcesContainer.innerHTML = `<div class="no-results" style="color: #e53e3e;">${message}</div>`;
          answerContainer.innerHTML = `<div class="no-results" style="color: #e53e3e;">Unable to generate response due to search error.</div>`;
        }

        clearResults() {
          document.getElementById("sources").innerHTML =
            '<div class="no-results">Searching...</div>';
          document.getElementById("answer").innerHTML =
            '<div class="no-results">Generating response...</div>';
        }

        showLoading(show) {
          const loading = document.getElementById("loading");
          const searchBtn = document.getElementById("searchBtn");

          loading.style.display = show ? "flex" : "none";
          searchBtn.disabled = show;
        }
      }

      // Initialize the application
      document.addEventListener("DOMContentLoaded", () => {
        new MedicalRAGLLM();
      });
    </script>
  </body>
</html>
